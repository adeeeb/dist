import{c as $,d as z,r as N,j as a,m as J}from"./index-C6i5WGEk.js";import{i as P,S as U,d as G,f as K,a as V,b as Q}from"./index-CXW-1p9C.js";import{a as W}from"./axios-upsvKRUO.js";import{b as X}from"./background-Ci9soomE.js";function Y(j){let{swiper:e,extendParams:d,on:r,emit:n,params:c}=j;e.autoplay={running:!1,paused:!1,timeLeft:0},d({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!1,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});let i,E,C=c&&c.autoplay?c.autoplay.delay:3e3,w=c&&c.autoplay?c.autoplay.delay:3e3,o,g=new Date().getTime(),D,M,h,H,T,y,O;function t(s){!e||e.destroyed||!e.wrapperEl||s.target===e.wrapperEl&&(e.wrapperEl.removeEventListener("transitionend",t),!(O||s.detail&&s.detail.bySwiperTouchMove)&&f())}const p=()=>{if(e.destroyed||!e.autoplay.running)return;e.autoplay.paused?D=!0:D&&(w=o,D=!1);const s=e.autoplay.paused?o:g+w-new Date().getTime();e.autoplay.timeLeft=s,n("autoplayTimeLeft",s,s/C),E=requestAnimationFrame(()=>{p()})},S=()=>{let s;return e.virtual&&e.params.virtual.enabled?s=e.slides.find(u=>u.classList.contains("swiper-slide-active")):s=e.slides[e.activeIndex],s?parseInt(s.getAttribute("data-swiper-autoplay"),10):void 0},m=s=>{if(e.destroyed||!e.autoplay.running)return;cancelAnimationFrame(E),p();let x=typeof s>"u"?e.params.autoplay.delay:s;C=e.params.autoplay.delay,w=e.params.autoplay.delay;const u=S();!Number.isNaN(u)&&u>0&&typeof s>"u"&&(x=u,C=u,w=u),o=x;const k=e.params.speed,A=()=>{!e||e.destroyed||(e.params.autoplay.reverseDirection?!e.isBeginning||e.params.loop||e.params.rewind?(e.slidePrev(k,!0,!0),n("autoplay")):e.params.autoplay.stopOnLastSlide||(e.slideTo(e.slides.length-1,k,!0,!0),n("autoplay")):!e.isEnd||e.params.loop||e.params.rewind?(e.slideNext(k,!0,!0),n("autoplay")):e.params.autoplay.stopOnLastSlide||(e.slideTo(0,k,!0,!0),n("autoplay")),e.params.cssMode&&(g=new Date().getTime(),requestAnimationFrame(()=>{m()})))};return x>0?(clearTimeout(i),i=setTimeout(()=>{A()},x)):requestAnimationFrame(()=>{A()}),x},b=()=>{g=new Date().getTime(),e.autoplay.running=!0,m(),n("autoplayStart")},l=()=>{e.autoplay.running=!1,clearTimeout(i),cancelAnimationFrame(E),n("autoplayStop")},v=(s,x)=>{if(e.destroyed||!e.autoplay.running)return;clearTimeout(i),s||(y=!0);const u=()=>{n("autoplayPause"),e.params.autoplay.waitForTransition?e.wrapperEl.addEventListener("transitionend",t):f()};if(e.autoplay.paused=!0,x){T&&(o=e.params.autoplay.delay),T=!1,u();return}o=(o||e.params.autoplay.delay)-(new Date().getTime()-g),!(e.isEnd&&o<0&&!e.params.loop)&&(o<0&&(o=0),u())},f=()=>{e.isEnd&&o<0&&!e.params.loop||e.destroyed||!e.autoplay.running||(g=new Date().getTime(),y?(y=!1,m(o)):m(),e.autoplay.paused=!1,n("autoplayResume"))},I=()=>{if(e.destroyed||!e.autoplay.running)return;const s=P();s.visibilityState==="hidden"&&(y=!0,v(!0)),s.visibilityState==="visible"&&f()},L=s=>{s.pointerType==="mouse"&&(y=!0,O=!0,!(e.animating||e.autoplay.paused)&&v(!0))},_=s=>{s.pointerType==="mouse"&&(O=!1,e.autoplay.paused&&f())},R=()=>{e.params.autoplay.pauseOnMouseEnter&&(e.el.addEventListener("pointerenter",L),e.el.addEventListener("pointerleave",_))},B=()=>{e.el&&typeof e.el!="string"&&(e.el.removeEventListener("pointerenter",L),e.el.removeEventListener("pointerleave",_))},F=()=>{P().addEventListener("visibilitychange",I)},q=()=>{P().removeEventListener("visibilitychange",I)};r("init",()=>{e.params.autoplay.enabled&&(R(),F(),b())}),r("destroy",()=>{B(),q(),e.autoplay.running&&l()}),r("_freeModeStaticRelease",()=>{(h||y)&&f()}),r("_freeModeNoMomentumRelease",()=>{e.params.autoplay.disableOnInteraction?l():v(!0,!0)}),r("beforeTransitionStart",(s,x,u)=>{e.destroyed||!e.autoplay.running||(u||!e.params.autoplay.disableOnInteraction?v(!0,!0):l())}),r("sliderFirstMove",()=>{if(!(e.destroyed||!e.autoplay.running)){if(e.params.autoplay.disableOnInteraction){l();return}M=!0,h=!1,y=!1,H=setTimeout(()=>{y=!0,h=!0,v(!0)},200)}}),r("touchEnd",()=>{if(!(e.destroyed||!e.autoplay.running||!M)){if(clearTimeout(H),clearTimeout(i),e.params.autoplay.disableOnInteraction){h=!1,M=!1;return}h&&e.params.cssMode&&f(),h=!1,M=!1}}),r("slideChange",()=>{e.destroyed||!e.autoplay.running||(T=!0)}),Object.assign(e.autoplay,{start:b,stop:l,pause:v,resume:f})}const Z=[V,Q,X],re=()=>{const{t:j}=$(),e=z(),[d,r]=N.useState([]),[n,c]=N.useState([]),[i,E]=N.useState(null),[C,w]=N.useState(""),[o,g]=N.useState(!1),D=()=>{const t=Date.now();return sessionStorage.setItem("session_id",t.toString()),t},h=(()=>{const t=sessionStorage.getItem("session_id");return!t||isNaN(parseInt(t,10))?D():parseInt(t,10)})();console.log("User Session ID:",h),N.useEffect(()=>{const t=JSON.parse(localStorage.getItem("chatHistory"));t&&r(t)},[]),N.useEffect(()=>{localStorage.setItem("chatHistory",JSON.stringify(d))},[d]);const H=()=>{if(i!==null){const S=d.map(m=>m.id===i?{...m,messages:n}:m);r(S)}const t=d.length>0?d[d.length-1].id+1:1,p={id:t,messages:[]};r(S=>[...S,p]),c([]),E(t),w("")},T=async t=>{const p=new Date().toLocaleString(),S={userMessage:t,botResponse:"",timestamp:p},m=[...n,S];if(c(m),i!==null){const b=d.map(l=>l.id===i?{...l,messages:m}:l);r(b)}g(!0);try{const b=localStorage.getItem("user_id")||null,l=await W.post("http://127.0.0.1:8000/api/chat/",{message:t,session_id:h,summary:C,user_id:b}),v=l.data.message;w(l.data.summary);const f={userMessage:"",botResponse:v,timestamp:new Date().toLocaleString()};if(c(I=>[...I,f]),i!==null){const I=d.map(L=>L.id===i?{...L,messages:[...prev,f]}:L);r(I)}g(!1)}catch(b){console.error("Error sending message",b),g(!1)}},y=t=>{c(t.messages),E(t.id)},O=()=>{e("/")};return a.jsxs("div",{className:"relative w-full h-screen bg-gray-100 flex",children:[a.jsx("div",{className:"absolute inset-0 z-0",children:a.jsx(U,{modules:[Y],autoplay:{delay:3e3,disableOnInteraction:!1},loop:!0,className:"w-full h-full",children:Z.map((t,p)=>a.jsx(G,{children:a.jsx("img",{src:t,alt:`Background ${p+1}`,className:"w-full h-full object-cover"})},p))})}),a.jsxs(J.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,ease:"easeInOut"},className:"relative z-10 flex w-full max-w-5xl mx-auto my-8 bg-white shadow-lg rounded-lg overflow-hidden",children:[a.jsxs("div",{className:"w-80 bg-gray-50 border-r border-gray-200 flex flex-col",children:[a.jsx("div",{className:"p-4 border-b",children:a.jsxs("button",{onClick:H,className:"w-full flex items-center justify-center py-2 bg-white border border-gray-300 rounded-md shadow-sm text-amber-900 hover:bg-gray-100",children:[a.jsx(K,{className:"mr-2",size:20}),a.jsx("span",{children:j("chatbot.newConversation")})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:d.map(t=>a.jsxs("div",{onClick:()=>y(t),className:`p-3 bg-white rounded-md cursor-pointer hover:bg-gray-100 ${i===t.id?"ring-2 ring-amber-900":""}`,children:[a.jsx("p",{className:"text-sm text-gray-700",children:t.messages.length>0?t.messages[t.messages.length-1].userMessage:j("chatbot.newConversation")}),t.messages.length>0&&a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["(",t.messages.length," messages)"]})]},t.id))})]}),a.jsxs("div",{className:"flex-1 flex flex-col",children:[a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-white",children:[n.map((t,p)=>a.jsx("div",{className:`flex ${t.userMessage?"justify-end":"justify-start"}`,children:a.jsxs("div",{className:`p-3 rounded-md max-w-md ${t.userMessage?"bg-amber-900 text-white":"bg-gray-200 text-gray-800"}`,children:[a.jsx("p",{className:"text-sm",children:t.userMessage||t.botResponse}),a.jsx("span",{className:"block text-xs text-gray-500 mt-1",children:t.timestamp})]})},p)),o&&a.jsx("div",{className:"flex justify-start",children:a.jsx("div",{className:"p-3 rounded-md max-w-md bg-gray-200 text-gray-800",children:a.jsxs("div",{className:"flex space-x-1",children:[a.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce"}),a.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-100"}),a.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce delay-200"})]})})})]}),a.jsx("div",{className:"p-4 border-t border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"text",placeholder:j("chatbot.askMe"),className:"flex-1 border border-gray-300 rounded-l-md px-3 py-2 focus:outline-none",onKeyDown:t=>{t.key==="Enter"&&t.target.value.trim()&&(T(t.target.value),t.target.value="")}}),a.jsx("button",{onClick:()=>{const t=document.querySelector("input[type='text']");t.value.trim()&&(T(t.value),t.value="")},className:"bg-amber-900 text-white px-4 py-2 rounded-r-md hover:bg-amber-800",children:j("chatbot.send")})]})})]})]}),a.jsx("button",{onClick:O,className:"absolute top-4 right-4 text-gray-600 hover:text-gray-800 focus:outline-none",children:"✖️"})]})};export{re as default};
